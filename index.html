<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>CEMC Volleyball Registration</title>
    <link rel="stylesheet" href="/css/styles.css" />
</head>

<body>
    <h1 id="CEMC">CEMC Volleyball Registration</h1>

    <form id="registrationForm">
        <input name="name" placeholder="Full Name" required />
        <input name="email" type="email" placeholder="Email" required />
        <button type="submit">Register</button>
    </form>

    <p id="message"></p>

    <div id="listsContainer"></div>

    <script>
        const form = document.getElementById("registrationForm");
        const message = document.getElementById("message");
        const listsContainer = document.getElementById("listsContainer");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const data = {
                name: form.name.value,
                email: form.email.value,
            };

            const res = await fetch("/api/register", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
            });

            const result = await res.json();
            message.textContent = result.message;
            listsContainer.innerHTML = "";
            if (result.registered) {
                const registeredDiv = document.createElement("div");
                const registeredList = document.createElement("ul");
                result.registered.forEach((user) => {
                    const listItem = document.createElement("li");
                    listItem.textContent = user.name + " (" + user.email + ")";
                    registeredList.appendChild(listItem);
                });
                    const registeredTitle = document.createElement("h2");
                    registeredTitle.textContent = "Registered Players";
                    registeredDiv.appendChild(registeredTitle);
                    registeredDiv.appendChild(registeredList);
                    listsContainer.appendChild(registeredDiv);
                }
            if (result.waitlisted) {
                const waitlistedDiv = document.createElement("div");
                const waitlistedList = document.createElement("ul");
                result.waitlisted.forEach((user) => {
                    const listItem = document.createElement("li");
                    listItem.textContent = user.name + " (" + user.email + ")";
                    waitlistedList.appendChild(listItem);
                });
                const waitlistedTitle = document.createElement("h2");
                waitlistedTitle.textContent = "Waitlisted Players";
                waitlistedDiv.appendChild(waitlistedTitle);
                waitlistedDiv.appendChild(waitlistedList);
                listsContainer.appendChild(waitlistedDiv);
            }
        });
    </script>
</body>

</html>